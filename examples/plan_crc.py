import re
import matplotlib.pyplot as plt

from datetime import time
from functools import reduce
from tabulate import tabulate
from pywfplan import Shift, StaffPlanner


def work_shifts_for_agent(shifts, agent):
    t_week  = time(hour=agent["t0"] // 60, minute=agent["t0"] % 60)
    t_wend0 = time(hour=agent["t1"] // 60, minute=agent["t1"] % 60)
    t_wend1 = time(hour=agent["t2"] // 60, minute=agent["t2"] % 60)

    week_shifts = [s for s in shifts if s.is_work() and s.start_time() == t_week]
    wend_shifts = [s for s in shifts if s.is_work() and t_wend0 <= s.start_time() and s.start_time() <= t_wend1]

    return reduce(lambda a,b: a+b, week_shifts), reduce(lambda a,b: a+b, wend_shifts)


shifts = [Shift.fromSpec(*s) for s in [
    ["S2345", "23:45-25:40,25:50-26:45,27:05-28:00,28:10-30:05"],
    ["S2330", "23:30-25:25,25:35-26:30,26:50-27:45,27:55-29:50"],
    ["S2315", "23:15-25:10,25:20-26:15,26:35-27:30,27:40-29:35"],
    ["S2300", "23:00-24:55,25:05-26:00,26:20-27:15,27:25-29:20"],
    ["S2245", "22:45-24:40,24:50-25:45,26:05-27:00,27:10-29:05"],
    ["S2230", "22:30-24:25,24:35-25:30,25:50-26:45,26:55-28:50"],
    ["S2215", "22:15-24:10,24:20-25:15,25:35-26:30,26:40-28:35"],
    ["S2200", "22:00-23:55,24:05-25:00,25:20-26:15,26:25-28:20"],
    ["S2145", "21:45-23:40,23:50-24:45,25:05-26:00,26:10-28:05"],
    ["S2130", "21:30-23:25,23:35-24:30,24:50-25:45,25:55-27:50"],
    ["S2115", "21:15-23:10,23:20-24:15,24:35-25:30,25:40-27:35"],
    ["S2100", "21:00-22:55,23:05-24:00,24:20-25:15,25:25-27:20"],
    ["S2045", "20:45-22:40,22:50-23:45,24:05-25:00,25:10-27:05"],
    ["S2030", "20:30-22:25,22:35-23:30,23:50-24:45,24:55-26:50"],
    ["S2015", "20:15-22:10,22:20-23:15,23:35-24:30,24:40-26:35"],
    ["S2000", "20:00-21:55,22:05-23:00,23:20-24:15,24:25-26:20"],
    ["S1945", "19:45-21:40,21:50-22:45,23:05-24:00,24:10-26:05"],
    ["S1930", "19:30-21:25,21:35-22:30,22:50-23:45,23:55-25:50"],
    ["S1915", "19:15-21:10,21:20-22:15,22:35-23:30,23:40-25:35"],
    ["S1900", "19:00-20:55,21:05-22:00,22:20-23:15,23:25-25:20"],
    ["S1845", "18:45-20:40,20:50-21:45,22:05-23:00,23:10-25:05"],
    ["S1830", "18:30-20:25,20:35-21:30,21:50-22:45,22:55-24:50"],
    ["S1815", "18:15-20:10,20:20-21:15,21:35-22:30,22:40-24:35"],
    ["S1800", "18:00-19:55,20:05-21:00,21:20-22:15,22:25-24:20"],
    ["S1745", "17:45-19:40,19:50-20:45,21:05-22:00,22:10-24:05"],
    ["S1730", "17:30-19:25,19:35-20:30,20:50-21:45,21:55-23:50"],
    ["S1715", "17:15-19:10,19:20-20:15,20:35-21:30,21:40-23:35"],
    ["S1700", "17:00-18:55,19:05-20:00,20:20-21:15,21:25-23:20"],
    ["S1645", "16:45-18:40,18:50-19:45,20:05-21:00,21:10-23:05"],
    ["S1630", "16:30-18:25,18:35-19:30,19:50-20:45,20:55-22:50"],
    ["S1615", "16:15-18:10,18:20-19:15,19:35-20:30,20:40-22:35"],
    ["S1600", "16:00-17:55,18:05-19:00,19:20-20:15,20:25-22:20"],
    ["S1545", "15:45-17:40,17:50-18:45,19:05-20:00,20:10-22:05"],
    ["S1530", "15:30-17:25,17:35-18:30,18:50-19:45,19:55-21:50"],
    ["S1515", "15:15-17:10,17:20-18:15,18:35-19:30,19:40-21:35"],
    ["S1500", "15:00-16:55,17:05-18:00,18:20-19:15,19:25-21:20"],
    ["S1445", "14:45-16:40,16:50-17:45,18:05-19:00,19:10-21:05"],
    ["S1430", "14:30-16:25,16:35-17:30,17:50-18:45,18:55-20:50"],
    ["S1415", "14:15-16:10,16:20-17:15,17:35-18:30,18:40-20:35"],
    ["S1400", "14:00-15:55,16:05-17:00,17:20-18:15,18:25-20:20"],
    ["S1345", "13:45-15:40,15:50-16:45,17:05-18:00,18:10-20:05"],
    ["S1330", "13:30-15:25,15:35-16:30,16:50-17:45,17:55-19:50"],
    ["S1315", "13:15-15:10,15:20-16:15,16:35-17:30,17:40-19:35"],
    ["S1300", "13:00-14:55,15:05-16:00,16:20-17:15,17:25-19:20"],
    ["S1245", "12:45-14:40,14:50-15:45,16:05-17:00,17:10-19:05"],
    ["S1230", "12:30-14:25,14:35-15:30,15:50-16:45,16:55-18:50"],
    ["S1215", "12:15-14:10,14:20-15:15,15:35-16:30,16:40-18:35"],
    ["S1200", "12:00-13:55,14:05-15:00,15:20-16:15,16:25-18:20"],
    ["S1145", "11:45-13:40,13:50-14:45,15:05-16:00,16:10-18:05"],
    ["S1130", "11:30-13:25,13:35-14:30,14:50-15:45,15:55-17:50"],
    ["S1115", "11:15-13:10,13:20-14:15,14:35-15:30,15:40-17:35"],
    ["S1100", "11:00-12:55,13:05-14:00,14:20-15:15,15:25-17:20"],
    ["S1045", "10:45-12:40,12:50-13:45,14:05-15:00,15:10-17:05"],
    ["S1030", "10:30-12:25,12:35-13:30,13:50-14:45,14:55-16:50"],
    ["S1015", "10:15-12:10,12:20-13:15,13:35-14:30,14:40-16:35"],
    ["S1000", "10:00-11:55,12:05-13:00,13:20-14:15,14:25-16:20"],
    ["S0945", "09:45-11:40,11:50-12:45,13:05-14:00,14:10-16:05"],
    ["S0930", "09:30-11:25,11:35-12:30,12:50-13:45,13:55-15:50"],
    ["S0915", "09:15-11:10,11:20-12:15,12:35-13:30,13:40-15:35"],
    ["S0900", "09:00-10:55,11:05-12:00,12:20-13:15,13:25-15:20"],
    ["S0845", "08:45-10:40,10:50-11:45,12:05-13:00,13:10-15:05"],
    ["S0830", "08:30-10:25,10:35-11:30,11:50-12:45,12:55-14:50"],
    ["S0815", "08:15-10:10,10:20-11:15,11:35-12:30,12:40-14:35"],
    ["S0800", "08:00-09:55,10:05-11:00,11:20-12:15,12:25-14:20"],
    ["S0745", "07:45-09:40,09:50-10:45,11:05-12:00,12:10-14:05"],
    ["S0730", "07:30-09:25,09:35-10:30,10:50-11:45,11:55-13:50"],
    ["S0715", "07:15-09:10,09:20-10:15,10:35-11:30,11:40-13:35"],
    ["S0700", "07:00-08:55,09:05-10:00,10:20-11:15,11:25-13:20"],
    ["S0645", "06:45-08:40,08:50-09:45,10:05-11:00,11:10-13:05"],
    ["S0630", "06:30-08:25,08:35-09:30,09:50-10:45,10:55-12:50"],
    ["S0615", "06:15-08:10,08:20-09:15,09:35-10:30,10:40-12:35"],
    ["S0600", "06:00-07:55,08:05-09:00,09:20-10:15,10:25-12:20"],
    ["S0545", "05:45-07:40,07:50-08:45,09:05-10:00,10:10-12:05"],
    ["S0530", "05:30-07:25,07:35-08:30,08:50-09:45,09:55-11:50"],
    ["S0515", "05:15-07:10,07:20-08:15,08:35-09:30,09:40-11:35"],
    ["S0500", "05:00-06:55,07:05-08:00,08:20-09:15,09:25-11:20"],
    ["S0445", "04:45-06:40,06:50-07:45,08:05-09:00,09:10-11:05"],
    ["S0430", "04:30-06:25,06:35-07:30,07:50-08:45,08:55-10:50"],
    ["S0415", "04:15-06:10,06:20-07:15,07:35-08:30,08:40-10:35"],
    ["S0400", "04:00-05:55,06:05-07:00,07:20-08:15,08:25-10:20"],
    ["S0345", "03:45-05:40,05:50-06:45,07:05-08:00,08:10-10:05"],
    ["S0330", "03:30-05:25,05:35-06:30,06:50-07:45,07:55-09:50"],
    ["S0315", "03:15-05:10,05:20-06:15,06:35-07:30,07:40-09:35"],
    ["S0300", "03:00-04:55,05:05-06:00,06:20-07:15,07:25-09:20"],
    ["S0245", "02:45-04:40,04:50-05:45,06:05-07:00,07:10-09:05"],
    ["S0230", "02:30-04:25,04:35-05:30,05:50-06:45,06:55-08:50"],
    ["S0215", "02:15-04:10,04:20-05:15,05:35-06:30,06:40-08:35"],
    ["S0200", "02:00-03:55,04:05-05:00,05:20-06:15,06:25-08:20"],
    ["S0145", "01:45-03:40,03:50-04:45,05:05-06:00,06:10-08:05"],
    ["S0130", "01:30-03:25,03:35-04:30,04:50-05:45,05:55-07:50"],
    ["S0115", "01:15-03:10,03:20-04:15,04:35-05:30,05:40-07:35"],
    ["S0100", "01:00-02:55,03:05-04:00,04:20-05:15,05:25-07:20"],
    ["S0045", "00:45-02:40,02:50-03:45,04:05-05:00,05:10-07:05"],
    ["S0030", "00:30-02:25,02:35-03:30,03:50-04:45,04:55-06:50"],
    ["S0015", "00:15-02:10,02:20-03:15,03:35-04:30,04:40-06:35"],
    ["S0000", "00:00-01:55,02:05-03:00,03:20-04:15,04:25-06:20"]
]]

agents = {
    "O4158251": {"t0":450,  "t1":330, "t2":570},
    "O4158272": {"t0":885,  "t1":765, "t2":1005},
    "O4158541": {"t0":525,  "t1":405, "t2":645},
    "O4158553": {"t0":390,  "t1":270, "t2":510},
    "O4158577": {"t0":420,  "t1":300, "t2":540},
    "O4158987": {"t0":1065, "t1":945, "t2":1185},
    "O4161034": {"t0":1065, "t1":945, "t2":1185},
    "O4161216": {"t0":60,   "t1":0,   "t2":180},
    "O4161281": {"t0":360,  "t1":240, "t2":480},
    "O4161322": {"t0":975,  "t1":855, "t2":1095},
    "O4161357": {"t0":390,  "t1":270, "t2":510},
    "O4161384": {"t0":450,  "t1":330, "t2":570},
    "O4161466": {"t0":1065, "t1":945, "t2":1185},
    "O4161598": {"t0":525,  "t1":405, "t2":645},
    "O4161815": {"t0":585,  "t1":465, "t2":705},
    "O4161818": {"t0":420,  "t1":300, "t2":540},
    "O4161831": {"t0":630,  "t1":510, "t2":750},
    "O4161857": {"t0":420,  "t1":300, "t2":540},
    "O4161966": {"t0":525,  "t1":405, "t2":645},
    "O4161969": {"t0":885,  "t1":765, "t2":1005},
    "O4163662": {"t0":360,  "t1":240, "t2":480},
    "O4164225": {"t0":450,  "t1":330, "t2":570},
    "O4164253": {"t0":525,  "t1":405, "t2":645},
    "O4164299": {"t0":885,  "t1":765, "t2":1005},
    "O4164316": {"t0":60,   "t1":0,   "t2":180},
    "O4164329": {"t0":480,  "t1":360, "t2":600},
    "O4165566": {"t0":750,  "t1":630, "t2":870},
    "O4165585": {"t0":60,   "t1":0,   "t2":180},
    "O4165590": {"t0":360,  "t1":240, "t2":480},
    "O4165731": {"t0":360,  "t1":240, "t2":480},
    "O4165985": {"t0":450,  "t1":330, "t2":570},
    "O4166460": {"t0":855,  "t1":735, "t2":975},
    "O4166582": {"t0":540,  "t1":420, "t2":660},
    "O4166738": {"t0":480,  "t1":360, "t2":600},
    "O4166797": {"t0":660,  "t1":540, "t2":780},
    "O4168107": {"t0":630,  "t1":510, "t2":750},
    "O4168160": {"t0":750,  "t1":630, "t2":870},
    "O4169150": {"t0":390,  "t1":270, "t2":510},
    "O4169157": {"t0":585,  "t1":465, "t2":705},
    "O4169160": {"t0":885,  "t1":765, "t2":1005},
    "O4169213": {"t0":420,  "t1":300, "t2":540},
    "O4169292": {"t0":480,  "t1":360, "t2":600},
    "O4169424": {"t0":1005, "t1":885, "t2":1125},
    "O4170342": {"t0":885,  "t1":765, "t2":1005},
    "O4170554": {"t0":675,  "t1":555, "t2":795},
    "O4170567": {"t0":930,  "t1":810, "t2":1050},
    "O4170612": {"t0":750,  "t1":630, "t2":870},
    "O4170622": {"t0":930,  "t1":810, "t2":1050},
    "O4170647": {"t0":390,  "t1":270, "t2":510},
    "O4170707": {"t0":630,  "t1":510, "t2":750},
    "O4170795": {"t0":390,  "t1":270, "t2":510},
    "O4170798": {"t0":390,  "t1":270, "t2":510},
    "O4170800": {"t0":525,  "t1":405, "t2":645},
    "O4170819": {"t0":390,  "t1":270, "t2":510},
    "O4170833": {"t0":480,  "t1":360, "t2":600},
    "O4171755": {"t0":420,  "t1":300, "t2":540},
    "O4171757": {"t0":975,  "t1":855, "t2":1095},
    "O4171759": {"t0":480,  "t1":360, "t2":600},
    "O4171769": {"t0":420,  "t1":300, "t2":540},
    "O4171817": {"t0":570,  "t1":450, "t2":690},
    "O4171841": {"t0":600,  "t1":480, "t2":720},
    "O4171848": {"t0":975,  "t1":855, "t2":1095},
    "O4171868": {"t0":885,  "t1":765, "t2":1005},
    "O4171874": {"t0":360,  "t1":240, "t2":480},
    "O4172078": {"t0":870,  "t1":750, "t2":990},
    "O4172948": {"t0":525,  "t1":405, "t2":645},
    "O4173027": {"t0":405,  "t1":285, "t2":525},
    "O4173061": {"t0":885,  "t1":765, "t2":1005},
    "O4173064": {"t0":675,  "t1":555, "t2":795},
    "O4173101": {"t0":570,  "t1":450, "t2":690},
    "O4173113": {"t0":525,  "t1":405, "t2":645},
    "O4173136": {"t0":360,  "t1":240, "t2":480},
    "O4173140": {"t0":675,  "t1":555, "t2":795},
    "O4173254": {"t0":975,  "t1":855, "t2":1095},
    "O4173285": {"t0":750,  "t1":630, "t2":870},
    "O4173323": {"t0":630,  "t1":510, "t2":750},
    "O4173374": {"t0":420,  "t1":300, "t2":540},
    "O4173394": {"t0":420,  "t1":300, "t2":540},
    "O4173607": {"t0":885,  "t1":765, "t2":1005},
    "O4173610": {"t0":975,  "t1":855, "t2":1095},
    "O4173613": {"t0":525,  "t1":405, "t2":645},
    "O4174899": {"t0":660,  "t1":540, "t2":780},
    "O4501090": {"t0":750,  "t1":630, "t2":870},
    "O4501093": {"t0":1050, "t1":930, "t2":1170},
    "O4505232": {"t0":750,  "t1":630, "t2":870},
    "O4505245": {"t0":525,  "t1":405, "t2":645},
    "O4505261": {"t0":660,  "t1":540, "t2":780},
    "O4505284": {"t0":750,  "t1":630, "t2":870},
    "O4505286": {"t0":1065, "t1":945, "t2":1185},
    "O4505309": {"t0":1065, "t1":945, "t2":1185},
    "O4510578": {"t0":570,  "t1":450, "t2":690},
    "O4510602": {"t0":750,  "t1":630, "t2":870},
    "O4510605": {"t0":525,  "t1":405, "t2":645},
    "O4510608": {"t0":525,  "t1":405, "t2":645},
    "O4510621": {"t0":855,  "t1":735, "t2":975},
    "O4510631": {"t0":420,  "t1":300, "t2":540},
    "O4510637": {"t0":660,  "t1":540, "t2":780},
    "O4510643": {"t0":660,  "t1":540, "t2":780},
    "O4510646": {"t0":975,  "t1":855, "t2":1095},
    "O4510647": {"t0":480,  "t1":360, "t2":600},
    "O4510941": {"t0":525,  "t1":405, "t2":645},
    "O4510943": {"t0":855,  "t1":735, "t2":975},
    "O4513565": {"t0":885,  "t1":765, "t2":1005},
    "O4513772": {"t0":960,  "t1":840, "t2":1080},
    "O4513787": {"t0":750,  "t1":630, "t2":870},
    "O4513799": {"t0":960,  "t1":840, "t2":1080},
    "O4513802": {"t0":870,  "t1":750, "t2":990},
    "O4513805": {"t0":1050, "t1":930, "t2":1170},
    "O4513810": {"t0":900,  "t1":780, "t2":1020},
    "O4513816": {"t0":660,  "t1":540, "t2":780},
    "O4513839": {"t0":585,  "t1":465, "t2":705},
    "O4513854": {"t0":660,  "t1":540, "t2":780},
    "O4513870": {"t0":960,  "t1":840, "t2":1080},
    "O4513887": {"t0":630,  "t1":510, "t2":750},
    "O4513908": {"t0":660,  "t1":540, "t2":780},
    "O4517054": {"t0":855,  "t1":735, "t2":975},
    "O4517085": {"t0":855,  "t1":735, "t2":975},
    "O4517113": {"t0":1005, "t1":885, "t2":1125},
    "O4517125": {"t0":750,  "t1":630, "t2":870},
    "O4517135": {"t0":885,  "t1":765, "t2":1005},
    "O4519879": {"t0":360,  "t1":240, "t2":480},
    "O4519893": {"t0":360,  "t1":240, "t2":480},
    "O4519910": {"t0":855,  "t1":735, "t2":975},
    "O4519916": {"t0":360,  "t1":240, "t2":480},
    "O4519917": {"t0":585,  "t1":465, "t2":705},
    "O4519918": {"t0":405,  "t1":285, "t2":525},
    "O4519927": {"t0":660,  "t1":540, "t2":780},
    "O4519941": {"t0":1095, "t1":975, "t2":1215},
    "O4519942": {"t0":585,  "t1":465, "t2":705},
    "O4519947": {"t0":570,  "t1":450, "t2":690},
    "O4519953": {"t0":960,  "t1":840, "t2":1080},
    "O4522055": {"t0":525,  "t1":405, "t2":645},
    "O4522079": {"t0":885,  "t1":765, "t2":1005},
    "O4522113": {"t0":1005, "t1":885, "t2":1125},
    "O4522138": {"t0":900,  "t1":780, "t2":1020},
    "O4522150": {"t0":1095, "t1":975, "t2":1215},
    "O4522189": {"t0":360,  "t1":240, "t2":480},
    "O4522238": {"t0":675,  "t1":555, "t2":795},
    "O4522242": {"t0":675,  "t1":555, "t2":795},
    "O4522271": {"t0":525,  "t1":405, "t2":645},
    "O4522278": {"t0":360,  "t1":240, "t2":480},
    "O4522283": {"t0":750,  "t1":630, "t2":870},
    "O4522307": {"t0":1020, "t1":900, "t2":1140},
    "O4522313": {"t0":1020, "t1":900, "t2":1140},
    "O4522373": {"t0":360,  "t1":240, "t2":480},
    "O4522374": {"t0":405,  "t1":285, "t2":525},
    "O4528225": {"t0":450,  "t1":330, "t2":570},
    "O4532714": {"t0":60,   "t1":0,   "t2":180},
    "O4532722": {"t0":675,  "t1":555, "t2":795},
    "O4532728": {"t0":1050, "t1":930, "t2":1170},
    "O4532730": {"t0":405,  "t1":285, "t2":525},
    "O4532736": {"t0":1035, "t1":915, "t2":1155},
    "O4532743": {"t0":480,  "t1":360, "t2":600},
    "O4532755": {"t0":480,  "t1":360, "t2":600},
    "O4532766": {"t0":60,   "t1":0,   "t2":180},
    "O4532823": {"t0":870,  "t1":750, "t2":990},
    "O4532845": {"t0":660,  "t1":540, "t2":780},
    "O4532866": {"t0":1065, "t1":945, "t2":1185},
    "O4532870": {"t0":885,  "t1":765, "t2":1005},
    "O4532898": {"t0":1035, "t1":915, "t2":1155},
    "O4532909": {"t0":480,  "t1":360, "t2":600},
    "O4532926": {"t0":930,  "t1":810, "t2":1050},
    "O4532941": {"t0":1005, "t1":885, "t2":1125},
    "O4536852": {"t0":60,   "t1":0,   "t2":180},
    "O4536896": {"t0":1005, "t1":885, "t2":1125},
    "O4541363": {"t0":1065, "t1":945, "t2":1185},
    "O4541461": {"t0":1005, "t1":885, "t2":1125},
    "O4541468": {"t0":660,  "t1":540, "t2":780},
    "O4541470": {"t0":975,  "t1":855, "t2":1095},
    "O4541491": {"t0":1065, "t1":945, "t2":1185},
    "O4543881": {"t0":1005, "t1":885, "t2":1125},
    "O4543952": {"t0":630,  "t1":510, "t2":750},
    "O4543962": {"t0":885,  "t1":765, "t2":1005},
    "O4543978": {"t0":885,  "t1":765, "t2":1005},
    "O4548414": {"t0":1005, "t1":885, "t2":1125},
    "O4548421": {"t0":975,  "t1":855, "t2":1095},
    "O4548428": {"t0":1005, "t1":885, "t2":1125},
    "O4548534": {"t0":450,  "t1":330, "t2":570},
    "O4553382": {"t0":750,  "t1":630, "t2":870},
    "O4553453": {"t0":585,  "t1":465, "t2":705},
    "O4553461": {"t0":870,  "t1":750, "t2":990},
    "O4553463": {"t0":630,  "t1":510, "t2":750},
    "O4553479": {"t0":900,  "t1":780, "t2":1020},
    "O4553482": {"t0":1035, "t1":915, "t2":1155},
    "O4553522": {"t0":870,  "t1":750, "t2":990},
    "O4553536": {"t0":885,  "t1":765, "t2":1005},
    "O4557169": {"t0":60,   "t1":0,   "t2":180},
    "O4557193": {"t0":60,   "t1":0,   "t2":180},
    "O4557243": {"t0":885,  "t1":765, "t2":1005},
    "O4557319": {"t0":1035, "t1":915, "t2":1155},
    "O4565995": {"t0":60,   "t1":0,   "t2":180},
    "O4569276": {"t0":900,  "t1":780, "t2":1020},
    "O4569490": {"t0":900,  "t1":780, "t2":1020},
    "O4580689": {"t0":660,  "t1":540, "t2":780}
}

# 7 days 5 minutes slot
target = [5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 7, 7, 7, 7, 7, 7, 11, 11, 11, 11, 11, 11, 18, 18, 18, 18, 18, 18, 50, 50, 50, 50, 50, 50, 68, 68, 68, 68, 68, 68, 84, 84, 84, 84, 84, 84, 92, 92, 92, 92, 92, 92, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 94, 94, 94, 94, 94, 94, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 83, 83, 83, 83, 83, 83, 80, 80, 80, 80, 80, 80, 77, 77, 77, 77, 77, 77, 79, 79, 79, 79, 79, 79, 75, 75, 75, 75, 75, 75, 72, 72, 72, 72, 72, 72, 73, 73, 73, 73, 73, 73, 71, 71, 71, 71, 71, 71, 68, 68, 68, 68, 68, 68, 62, 62, 62, 62, 62, 62, 60, 60, 60, 60, 60, 60, 57, 57, 57, 57, 57, 57, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 42, 42, 42, 42, 42, 42, 31, 31, 31, 31, 31, 31, 23, 23, 23, 23, 23, 23, 18, 18, 18, 18, 18, 18, 12, 12, 12, 12, 12, 12, 8, 8, 8, 8, 8, 8, 6, 6, 6, 6, 6, 6, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 5, 5, 5, 5, 5, 7, 7, 7, 7, 7, 7, 12, 12, 12, 12, 12, 12, 18, 18, 18, 18, 18, 18, 52, 52, 52, 52, 52, 52, 70, 70, 70, 70, 70, 70, 84, 84, 84, 84, 84, 84, 91, 91, 91, 91, 91, 91, 96, 96, 96, 96, 96, 96, 101, 101, 101, 101, 101, 101, 100, 100, 100, 100, 100, 100, 95, 95, 95, 95, 95, 95, 96, 96, 96, 96, 96, 96, 90, 90, 90, 90, 90, 90, 89, 89, 89, 89, 89, 89, 88, 88, 88, 88, 88, 88, 84, 84, 84, 84, 84, 84, 79, 79, 79, 79, 79, 79, 82, 82, 82, 82, 82, 82, 79, 79, 79, 79, 79, 79, 77, 77, 77, 77, 77, 77, 73, 73, 73, 73, 73, 73, 70, 70, 70, 70, 70, 70, 66, 66, 66, 66, 66, 66, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 50, 50, 50, 50, 50, 50, 48, 48, 48, 48, 48, 48, 42, 42, 42, 42, 42, 42, 32, 32, 32, 32, 32, 32, 23, 23, 23, 23, 23, 23, 17, 17, 17, 17, 17, 17, 12, 12, 12, 12, 12, 12, 7, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 6, 5, 5, 5, 5, 5, 5, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 12, 12, 12, 12, 12, 12, 17, 17, 17, 17, 17, 17, 52, 52, 52, 52, 52, 52, 70, 70, 70, 70, 70, 70, 83, 83, 83, 83, 83, 83, 93, 93, 93, 93, 93, 93, 98, 98, 98, 98, 98, 98, 105, 105, 105, 105, 105, 105, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 93, 93, 93, 93, 93, 93, 91, 91, 91, 91, 91, 91, 87, 87, 87, 87, 87, 87, 86, 86, 86, 86, 86, 86, 81, 81, 81, 81, 81, 81, 82, 82, 82, 82, 82, 82, 79, 79, 79, 79, 79, 79, 77, 77, 77, 77, 77, 77, 74, 74, 74, 74, 74, 74, 68, 68, 68, 68, 68, 68, 69, 69, 69, 69, 69, 69, 68, 68, 68, 68, 68, 68, 65, 65, 65, 65, 65, 65, 63, 63, 63, 63, 63, 63, 59, 59, 59, 59, 59, 59, 54, 54, 54, 54, 54, 54, 52, 52, 52, 52, 52, 52, 50, 50, 50, 50, 50, 50, 38, 38, 38, 38, 38, 38, 31, 31, 31, 31, 31, 31, 23, 23, 23, 23, 23, 23, 17, 17, 17, 17, 17, 17, 12, 12, 12, 12, 12, 12, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 7, 7, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 13, 13, 13, 13, 13, 13, 20, 20, 20, 20, 20, 20, 48, 48, 48, 48, 48, 48, 66, 66, 66, 66, 66, 66, 81, 81, 81, 81, 81, 81, 89, 89, 89, 89, 89, 89, 94, 94, 94, 94, 94, 94, 98, 98, 98, 98, 98, 98, 96, 96, 96, 96, 96, 96, 93, 93, 93, 93, 93, 93, 90, 90, 90, 90, 90, 90, 89, 89, 89, 89, 89, 89, 88, 88, 88, 88, 88, 88, 83, 83, 83, 83, 83, 83, 82, 82, 82, 82, 82, 82, 78, 78, 78, 78, 78, 78, 79, 79, 79, 79, 79, 79, 75, 75, 75, 75, 75, 75, 74, 74, 74, 74, 74, 74, 73, 73, 73, 73, 73, 73, 71, 71, 71, 71, 71, 71, 70, 70, 70, 70, 70, 70, 67, 67, 67, 67, 67, 67, 66, 66, 66, 66, 66, 66, 62, 62, 62, 62, 62, 62, 59, 59, 59, 59, 59, 59, 53, 53, 53, 53, 53, 53, 51, 51, 51, 51, 51, 51, 42, 42, 42, 42, 42, 42, 34, 34, 34, 34, 34, 34, 24, 24, 24, 24, 24, 24, 19, 19, 19, 19, 19, 19, 13, 13, 13, 13, 13, 13, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 7, 7, 7, 7, 7, 7, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 9, 9, 9, 9, 9, 9, 13, 13, 13, 13, 13, 13, 19, 19, 19, 19, 19, 19, 49, 49, 49, 49, 49, 49, 69, 69, 69, 69, 69, 69, 88, 88, 88, 88, 88, 88, 97, 97, 97, 97, 97, 97, 100, 100, 100, 100, 100, 100, 102, 102, 102, 102, 102, 102, 100, 100, 100, 100, 100, 100, 97, 97, 97, 97, 97, 97, 91, 91, 91, 91, 91, 91, 93, 93, 93, 93, 93, 93, 88, 88, 88, 88, 88, 88, 85, 85, 85, 85, 85, 85, 84, 84, 84, 84, 84, 84, 78, 78, 78, 78, 78, 78, 78, 78, 78, 78, 78, 78, 75, 75, 75, 75, 75, 75, 78, 78, 78, 78, 78, 78, 72, 72, 72, 72, 72, 72, 71, 71, 71, 71, 71, 71, 68, 68, 68, 68, 68, 68, 62, 62, 62, 62, 62, 62, 59, 59, 59, 59, 59, 59, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 47, 47, 47, 47, 47, 47, 41, 41, 41, 41, 41, 41, 35, 35, 35, 35, 35, 35, 28, 28, 28, 28, 28, 28, 22, 22, 22, 22, 22, 22, 16, 16, 16, 16, 16, 16, 12, 12, 12, 12, 12, 12, 9, 9, 9, 9, 9, 9, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 11, 11, 11, 11, 11, 11, 27, 27, 27, 27, 27, 27, 38, 38, 38, 38, 38, 38, 47, 47, 47, 47, 47, 47, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 59, 59, 59, 59, 59, 59, 58, 58, 58, 58, 58, 58, 55, 55, 55, 55, 55, 55, 49, 49, 49, 49, 49, 49, 47, 47, 47, 47, 47, 47, 42, 42, 42, 42, 42, 42, 40, 40, 40, 40, 40, 40, 37, 37, 37, 37, 37, 37, 36, 36, 36, 36, 36, 36, 34, 34, 34, 34, 34, 34, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 29, 29, 29, 29, 29, 29, 27, 27, 27, 27, 27, 27, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 25, 25, 25, 25, 25, 25, 23, 23, 23, 23, 23, 23, 21, 21, 21, 21, 21, 21, 18, 18, 18, 18, 18, 18, 15, 15, 15, 15, 15, 15, 10, 10, 10, 10, 10, 10, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 7, 7, 4, 4, 4, 4, 4, 4, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 11, 11, 11, 11, 11, 11, 15, 15, 15, 15, 15, 15, 18, 18, 18, 18, 18, 18, 26, 26, 26, 26, 26, 26, 29, 29, 29, 29, 29, 29, 33, 33, 33, 33, 33, 33, 37, 37, 37, 37, 37, 37, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 37, 37, 37, 37, 37, 37, 37, 37, 37, 37, 37, 37, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 33, 33, 33, 33, 33, 33, 37, 37, 37, 37, 37, 37, 29, 29, 29, 29, 29, 29, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 22, 22, 22, 22, 22, 22, 18, 18, 18, 18, 18, 18, 15, 15, 15, 15, 15, 15]

# setup planner
planner = StaffPlanner()

# set staffing curve
planner.setStaffingTarget(target, days=7, slot_length=5)

# the rest shift
R = Shift.fromSpec("R")

# set agent rules
for code, agent in agents.items():
    print(agent)

    # the work shifts for this agent
    W, X = work_shifts_for_agent(shifts, agent)

    A  = W*W*W*W*W*X*R
    B  = W*W*W*W*W*R*X
    C  = W*W*W*W*R*X*X

    rule = A + B

    planner.addAgentRule(code, rule)

# run optimization
planner.run()

print(planner.getReport())

# print optimized plan
print(tabulate([[code, *planner.getAgentPlan(code)] for code in agents]))

# show staffing curves
trgt = planner.getTargetStaffing()
plan = planner.getPlannedStaffing()

plt.plot(trgt, label="Target")
plt.plot(plan, label="Planned")
plt.legend()
plt.show()
